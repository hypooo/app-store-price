<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="å…è´¹æŸ¥è¯¢ App Store åº”ç”¨ä»·æ ¼ï¼Œæ”¯æŒå¤šåœ°åŒºä»·æ ¼å¯¹æ¯”ã€å†…è´­ä¿¡æ¯æŸ¥è¯¢ã€‚å¿«é€ŸæŸ¥æ‰¾åº”ç”¨åœ¨ä¸åŒå›½å®¶çš„å®šä»·å’Œè´§å¸è½¬æ¢ã€‚">
    <meta name="keywords" content="App Store, åº”ç”¨ä»·æ ¼, ä»·æ ¼æŸ¥è¯¢, å†…è´­, åœ°åŒºä»·æ ¼, è´§å¸è½¬æ¢, åº”ç”¨å•†åº—">
    <meta name="robots" content="index, follow">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <title>App Store ä»·æ ¼æŸ¥è¯¢</title>

    <!-- é¢„åŠ è½½å…³é”®CSSèµ„æº -->
    <link rel="preload" href="https://cdn.tailwindcss.com" as="script">
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/daisyui@3.9.4/dist/full.css" as="style">

    <!-- Tailwind CSS + DaisyUI -->
    <link href="https://cdn.jsdelivr.net/npm/daisyui@3.9.4/dist/full.css" rel="stylesheet" type="text/css"/>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Alpine.js -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <!-- Axios -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        /* æ¸…çˆ½è‰²å½©ä¸»é¢˜ */
        :root {
            --fresh-primary: #10b981; /* ç¿ ç»¿è‰² */
            --fresh-secondary: #06b6d4; /* å¤©è“è‰² */
            --fresh-accent: #14b8a6; /* é’ç»¿è‰² */
            --fresh-light: #f0fdfa; /* æ·¡é’è‰²èƒŒæ™¯ */
            --fresh-gradient: linear-gradient(135deg, #a7f3d0 0%, #67e8f9 100%); /* æ¸…çˆ½æ¸å˜ */
            --fresh-card-gradient: linear-gradient(145deg, #ffffff 0%, #f0f9ff 100%);
        }

        /* é¡µé¢èƒŒæ™¯æ¸å˜ - ä¼˜åŒ–æ¸²æŸ“é˜²æ­¢é—ªçƒ */
        html {
            font-display: swap;
            text-rendering: optimizeLegibility;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        body {
            background: linear-gradient(135deg, #ecfdf5 0%, #f0f9ff 50%, #fefce8 100%) !important;
            min-height: 100vh;
            /* é˜²æ­¢é—ªçƒä¼˜åŒ– */
            transform: translateZ(0);
            backface-visibility: hidden;
            perspective: 1000px;
        }

        /* ä¸»æ ‡é¢˜æ¸…çˆ½æ ·å¼ - ä¼˜åŒ–æ¸å˜æ–‡å­—æ¸²æŸ“ */
        .fresh-title {
            background: var(--fresh-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 2px 10px rgba(16, 185, 129, 0.3);
            /* é˜²æ­¢æ¸å˜æ–‡å­—é—ªçƒ */
            transform: translateZ(0);
            will-change: background;
            /* ç¡®ä¿å¹³æ»‘æ¸²æŸ“ */
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
        }

        /* æ¸…çˆ½æŒ‰é’®æ ·å¼ - ä¼˜åŒ–æ¸å˜æ¸²æŸ“ */
        .btn-fresh-primary {
            background: var(--fresh-gradient);
            border: none;
            color: white;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
            /* é˜²æ­¢æ¸å˜é—ªçƒ */
            transform: translateZ(0);
            will-change: transform, box-shadow;
        }

        .btn-fresh-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.4);
        }

        .btn-fresh-secondary {
            background: linear-gradient(135deg, #06b6d4, #0891b2);
            border: none;
            color: white;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(6, 182, 212, 0.3);
            /* é˜²æ­¢æ¸å˜é—ªçƒ */
            transform: translateZ(0);
            will-change: transform, box-shadow;
        }

        .btn-fresh-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(6, 182, 212, 0.4);
        }

        /* æ¸…çˆ½å¡ç‰‡æ ·å¼ */
        .card-fresh {
            background: var(--fresh-card-gradient);
            border: 1px solid rgba(16, 185, 129, 0.1);
            box-shadow: 0 4px 20px rgba(16, 185, 129, 0.1);
            transition: all 0.3s ease;
        }

        .card-fresh:hover {
            box-shadow: 0 8px 30px rgba(16, 185, 129, 0.15);
            transform: translateY(-3px);
        }

        /* ä»·æ ¼æ˜¾ç¤ºæ¸…çˆ½æ ·å¼ */
        .price-fresh {
            color: var(--fresh-primary) !important;
            font-weight: 600;
        }

        .price-cny-fresh {
            color: var(--fresh-accent) !important;
            font-weight: 500;
        }

        /* æ–‡æœ¬æˆªæ–­æ ·å¼ */
        .line-clamp-2 {
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }

        /* ToaståŠ¨ç”» */
        .toast {
            animation: slideInDown 0.3s ease-out;
        }

        @keyframes slideInDown {
            from {
                transform: translate3d(0, -100%, 0);
                visibility: visible;
            }
            to {
                transform: translate3d(0, 0, 0);
            }
        }

        /* åº”ç”¨å¡ç‰‡æ‚¬åœæ•ˆæœå¢å¼º */
        .app-card {
            transition: all 0.3s ease-in-out;
            background: var(--fresh-card-gradient);
            border: 1px solid rgba(16, 185, 129, 0.08);
        }

        .app-card:hover:not(.disabled) {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(16, 185, 129, 0.15);
            border-color: rgba(16, 185, 129, 0.2);
        }

        .app-card.disabled {
            pointer-events: none;
        }

        /* æ¸…çˆ½åŠ è½½åŠ¨ç”» */
        .loading-fresh {
            color: var(--fresh-primary);
        }

        /* æ¸…çˆ½å¾½ç« æ ·å¼ */
        .badge-fresh {
            background: var(--fresh-gradient);
            color: #065f46; /* æ·±ç»¿è‰²æ–‡å­—ï¼Œæé«˜å¯è¯»æ€§ */
            border: none;
            font-weight: 600; /* åŠ ç²—æ–‡å­— */
        }

        /* ç»Ÿè®¡å¡ç‰‡æ¸…çˆ½æ ·å¼ */
        .stat-fresh {
            background: linear-gradient(145deg, #f0fdfa, #ecfdf5);
            border: 1px solid rgba(16, 185, 129, 0.1);
            box-shadow: 0 2px 10px rgba(16, 185, 129, 0.05);
        }

        /* æ»šåŠ¨æ¡æ¸…çˆ½æ ·å¼ */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f0fdfa;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #10b981, #14b8a6);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, #059669, #0f766e);
        }

        /* é¡µé¢åŠ è½½è¿‡æ¸¡æ•ˆæœ */
        body:not(.page-loaded) * {
            transition: opacity 0.3s ease-in-out !important;
        }

        body:not(.page-loaded) {
            opacity: 0;
        }

        body.page-loaded {
            opacity: 1;
        }

        /* æ¸è¿›å¼å†…å®¹æ˜¾ç¤º */
        .fade-in {
            animation: fadeInUp 0.6s ease-out forwards;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body class="min-h-screen" x-data="appStore()" :class="{ 'page-loaded': pageLoaded }">
<div class="container mx-auto p-4">
    <!-- é¡µé¢æ ‡é¢˜ -->
    <div class="text-center mb-8 fade-in">
        <h1 class="text-5xl font-bold fresh-title mb-4">App Store ä»·æ ¼æŸ¥è¯¢</h1>
        <p class="text-gray-600 text-lg">æŸ¥è¯¢åº”ç”¨åœ¨ä¸åŒåœ°åŒºçš„ä»·æ ¼å’Œå†…è´­ä¿¡æ¯</p>
        <div class="mt-4">
            <a href="https://github.com/hypooo" target="_blank" class="btn btn-sm btn-ghost">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                </svg>
                GitHub
            </a>
        </div>
    </div>

    <!-- æŒ‰åç§°æœç´¢åº”ç”¨ -->
    <div class="card card-fresh shadow-xl mb-6 fade-in" style="animation-delay: 0.2s; animation-fill-mode: both;">
        <div class="card-body">
            <h2 class="card-title text-xl" style="color: var(--fresh-primary)">ğŸ” æœç´¢åº”ç”¨</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="form-control">
                    <label class="label">
                        <span class="label-text">åº”ç”¨åç§°</span>
                    </label>
                    <label class="input input-bordered flex items-center gap-2">
                        <input
                            type="text"
                            x-model="appName"
                            placeholder="è¯·è¾“å…¥åº”ç”¨åç§°ï¼Œå¦‚ï¼šChatGPT"
                            class="grow"
                            :disabled="loadingAppList || loading"
                            @keyup.enter="loading ? null : searchAppList"
                            @focus="onSearchInputFocus"
                            @blur="onSearchInputBlur"
                        />
                        <button
                            type="button"
                            class="btn btn-ghost btn-xs"
                            @click="appName = ''"
                            title="æ¸…ç©ºåº”ç”¨åç§°"
                        >
                            âœ•
                        </button>
                    </label>
                </div>
                <div class="form-control">
                    <label class="label">
                        <span class="label-text">åœ°åŒºä»£ç </span>
                    </label>
                    <select x-model="areaCode" class="select select-bordered" :disabled="loadingAppList || loading || areaListLoading">
                        <template x-for="area in areaList" :key="area.code">
                            <option :value="area.code" x-text="area.name + ' (' + area.code.toUpperCase() + ')'"></option>
                        </template>
                        <template x-if="areaList.length === 0 && !areaListLoading">
                            <option disabled selected>æš‚æ— åœ°åŒºæ•°æ®</option>
                        </template>
                    </select>
                    <div x-show="areaListError" class="text-red-500 text-sm mt-1" x-text="areaListError"></div>
                </div>
            </div>

            <!-- çƒ­é—¨æœç´¢è¯ -->
            <div x-show="showPopularWords && popularWords.length > 0" x-transition class="mt-4">
                <label class="label">
                    <span class="label-text">ğŸ”¥ çƒ­é—¨æœç´¢</span>
                </label>
                <div class="flex flex-wrap gap-2" @mousedown.prevent>
                    <template x-for="word in popularWords" :key="word">
                        <button
                            type="button"
                            class="btn btn-xs btn-fresh-secondary"
                            @mousedown.prevent="selectPopularWord(word)"
                            :disabled="loadingAppList || loading"
                            x-text="word">
                        </button>
                    </template>
                </div>
            </div>

            <div class="form-control mt-4">
                <button
                    class="btn btn-fresh-secondary"
                    @click="searchAppList"
                    :disabled="loadingAppList || loading"
                >
                    <span x-show="!loadingAppList && !loading">ğŸš€ æœç´¢åº”ç”¨åˆ—è¡¨</span>
                    <span x-show="loadingAppList" class="loading loading-spinner loading-sm loading-fresh"></span>
                    <span x-show="loading" class="loading loading-spinner loading-sm loading-fresh"></span>
                </button>
            </div>
        </div>
    </div>

    <!-- åº”ç”¨åˆ—è¡¨å±•ç¤º -->
    <div x-show="appList.length > 0 && !loadingAppList" x-transition class="mb-6">
        <div class="card card-fresh shadow-xl">
            <div class="card-body">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="card-title" style="color: var(--fresh-primary)">ğŸ“± æœç´¢ç»“æœ</h3>
                    <button
                        @click="appListCollapsed = !appListCollapsed"
                        class="btn btn-sm btn-ghost"
                        :title="appListCollapsed ? 'å±•å¼€æœç´¢ç»“æœ' : 'æŠ˜å æœç´¢ç»“æœ'"
                    >
                        <svg x-show="!appListCollapsed" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"/>
                        </svg>
                        <svg x-show="appListCollapsed" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                        </svg>
                    </button>
                </div>
                <div x-show="!appListCollapsed" x-transition class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <template x-for="app in appList" :key="app.appId">
                        <div class="card card-compact shadow transition-colors app-card"
                             :class="loading ? 'cursor-not-allowed opacity-60 disabled' : 'cursor-pointer'"
                             @click="loading ? null : selectApp(app)">
                            <figure class="px-4 pt-4">
                                <img :src="app.appImage" :alt="app.appName" class="w-16 h-16 rounded-lg"/>
                            </figure>
                            <div class="card-body">
                                <div class="flex items-center justify-between">
                                    <h4 class="font-bold text-sm flex-1" x-text="app.appName"></h4>
                                    <div x-show="app.rating" class="flex items-center ml-2">
                                        <div class="rating rating-xs">
                                            <template x-for="i in 5" :key="i">
                                                <input type="radio" :name="'rating-' + app.appId" class="mask mask-star-2 bg-orange-400" :checked="i <= Math.round(app.rating)" disabled />
                                            </template>
                                        </div>
                                        <span class="text-xs font-medium ml-1" style="color: rgba(60, 60, 67, .6)" x-text="(app.rating).toFixed(1)"></span>
                                    </div>
                                </div>
                                <p class="text-xs text-gray-600 line-clamp-2" x-text="app.appDesc"></p>
                                <div class="text-xs font-medium mt-1" style="color: var(--fresh-accent)">
                                    ID: <span x-text="app.appId"></span>
                                </div>
                            </div>
                        </div>
                    </template>
                </div>
                <div x-show="appListCollapsed" x-transition
                     class="text-center py-4 text-gray-500 cursor-pointer hover:bg-base-200 transition-colors rounded-lg"
                     @click="appListCollapsed = !appListCollapsed">
                    æœç´¢ç»“æœå·²æŠ˜å ï¼Œç‚¹å‡»å±•å¼€
                </div>
            </div>
        </div>
    </div>


    <!-- é”™è¯¯æç¤º -->
    <div x-show="error || errorAppList" class="mb-6">
        <div x-show="error" class="alert mb-2" style="background: linear-gradient(135deg, #fef2f2, #fee2e2); border: 1px solid #fca5a5; color: #dc2626;" x-transition>
            <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
            <span x-text="error"></span>
        </div>
        <div x-show="errorAppList" class="alert mb-2" style="background: linear-gradient(135deg, #fef2f2, #fee2e2); border: 1px solid #fca5a5; color: #dc2626;" x-transition>
            <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
            <span x-text="errorAppList"></span>
        </div>
    </div>

    <!-- åŠ è½½çŠ¶æ€ -->
    <div x-show="loading || loadingAppList" class="flex justify-center items-center py-12">
        <div class="loading loading-spinner loading-lg loading-fresh"></div>
        <span x-show="loading" class="ml-2 text-lg" style="color: var(--fresh-primary)">â³ æ­£åœ¨æŸ¥è¯¢åº”ç”¨ä¿¡æ¯...</span>
        <span x-show="loadingAppList" class="ml-2 text-lg" style="color: var(--fresh-primary)">ğŸ” æ­£åœ¨æœç´¢åº”ç”¨åˆ—è¡¨...</span>
    </div>

    <!-- ç»“æœå±•ç¤º -->
    <div x-show="results.length > 0 && !loading" x-transition>
        <h2 class="text-3xl font-bold mb-6 fresh-title">âœ¨ æŸ¥è¯¢ç»“æœ</h2>

        <template x-for="app in results" :key="app.area">
            <div class="card card-fresh shadow-lg mb-6">
                <div class="card-body">
                    <div class="flex flex-col lg:flex-row lg:items-start gap-4">
                        <!-- åº”ç”¨åŸºæœ¬ä¿¡æ¯ -->
                        <div class="flex-1">
                            <div class="flex items-center gap-2 mb-2">
                                <h3 class="card-title text-lg" style="color: var(--fresh-primary)" x-text="app.name"></h3>
                                <div class="badge badge-fresh" x-text="app.area"></div>
                            </div>
                            <p class="text-gray-600 mb-2" x-text="app.subTitle"></p>
                            <p class="text-sm text-gray-500 mb-3">
                                ğŸ‘¨â€ğŸ’» å¼€å‘è€…: <span x-text="app.developer"></span>
                            </p>

                            <!-- åº”ç”¨ä»·æ ¼ -->
                            <div class="stat stat-fresh rounded-lg p-4 mb-4">
                                <div class="stat-title" style="color: var(--fresh-accent)">ğŸ’° åº”ç”¨ä»·æ ¼</div>
                                <div class="stat-value text-2xl price-fresh">
                                    <span x-text="app.price.currency"></span>
                                    <span x-text="app.price.price === 0 ? 'å…è´¹' : app.price.price"></span>
                                </div>
                                <div x-show="app.price.price > 0 && app.price.cnyPrice > 0" class="stat-desc text-sm price-cny-fresh font-medium mt-1">
                                    â‰ˆ Â¥<span x-text="app.price.cnyPrice.toFixed(2)"></span>
                                </div>
                            </div>

                            <a :href="app.appStoreUrl" target="_blank" class="btn btn-sm btn-fresh-primary">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 003 8.25v10.5A2.25 2.25 0 005.25 21h10.5A2.25 2.25 0 0018 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25"/>
                                </svg>
                                æŸ¥çœ‹App Store
                            </a>
                        </div>

                        <!-- å†…è´­ä¿¡æ¯ -->
                        <div class="flex-1">
                            <h4 class="font-bold mb-3" style="color: var(--fresh-primary)">ğŸ›’ å†…è´­é¡¹ç›®</h4>
                            <div x-show="app.inAppPurchaseList.length === 0" class="text-gray-500">
                                æš‚æ— å†…è´­é¡¹ç›®
                            </div>
                            <div class="space-y-3">
                                <template x-for="(purchase, index) in app.inAppPurchaseList" :key="index">
                                    <div class="card card-compact shadow" style="background: var(--fresh-card-gradient); border: 1px solid rgba(16, 185, 129, 0.1);">
                                        <div class="card-body">
                                            <div class="flex justify-between items-center">
                                                <h5 class="font-medium text-gray-700" x-text="purchase.object"></h5>
                                                <div class="text-right">
                                                    <div class="font-bold price-fresh">
                                                        <span x-text="purchase.price.currency"></span>
                                                        <span x-text="purchase.price.price"></span>
                                                    </div>
                                                    <div x-show="purchase.price.cnyPrice > 0" class="text-sm price-cny-fresh font-medium">
                                                        â‰ˆ Â¥<span x-text="purchase.price.cnyPrice.toFixed(2)"></span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </template>
    </div>

    <!-- ç©ºçŠ¶æ€ -->
    <div x-show="!loading && results.length === 0 && !error && searched" class="text-center py-12">
        <div class="text-6xl mb-4">ğŸ“±</div>
        <h3 class="text-xl font-bold mb-2" style="color: var(--fresh-primary)">æœªæ‰¾åˆ°åº”ç”¨ä¿¡æ¯</h3>
        <p class="text-gray-600">è¯·æ£€æŸ¥App IDæ˜¯å¦æ­£ç¡®</p>
    </div>

    <!-- åˆå§‹çŠ¶æ€ -->
    <div x-show="!loading && results.length === 0 && !error && !searched" class="text-center py-12">
        <div class="text-6xl mb-4">ğŸ”</div>
        <h3 class="text-xl font-bold mb-2" style="color: var(--fresh-primary)">å¼€å§‹æŸ¥è¯¢</h3>
        <p class="text-gray-600">è¯·å…ˆæœç´¢åº”ç”¨ï¼Œç„¶åç‚¹å‡»é€‰æ‹©åº”ç”¨æ¥æŸ¥è¯¢è¯¦ç»†ä¿¡æ¯</p>
    </div>
</div>


<script>
    function appStore() {
        return {
            // é¡µé¢åŠ è½½çŠ¶æ€
            pageLoaded: false,

            // æœç´¢åº”ç”¨åˆ—è¡¨ç›¸å…³
            appName: 'ChatGPT',
            areaCode: 'us',
            areaList: [],  // åœ°åŒºåˆ—è¡¨
            areaListError: '',  // åœ°åŒºåˆ—è¡¨é”™è¯¯ä¿¡æ¯
            areaListLoading: false,  // åœ°åŒºåˆ—è¡¨åŠ è½½çŠ¶æ€
            appList: [],
            loadingAppList: false,
            errorAppList: '',

            // çƒ­é—¨æœç´¢è¯ç›¸å…³
            popularWords: [],  // çƒ­é—¨æœç´¢è¯åˆ—è¡¨
            showPopularWords: false,  // æ§åˆ¶çƒ­é—¨æœç´¢è¯æ˜¾ç¤ºçŠ¶æ€
            popularWordsLoading: false,  // çƒ­é—¨æœç´¢è¯åŠ è½½çŠ¶æ€
            popularWordsError: '',  // çƒ­é—¨æœç´¢è¯é”™è¯¯ä¿¡æ¯

            // æŸ¥è¯¢åº”ç”¨ä¿¡æ¯ç›¸å…³
            appId: '',
            results: [],
            loading: false,
            error: '',
            searched: false,

            // æœç´¢ç»“æœæŠ˜å çŠ¶æ€
            appListCollapsed: false,

            async searchAppList() {
                if (!this.appName.trim()) {
                    this.errorAppList = 'è¯·è¾“å…¥åº”ç”¨åç§°';
                    return;
                }

                this.loadingAppList = true;
                this.errorAppList = '';
                this.appList = [];
                // æ¸…ç©ºä¹‹å‰çš„æŸ¥è¯¢ç»“æœ
                this.results = [];
                this.searched = false;
                this.error = '';
                // å±•å¼€æœç´¢ç»“æœ
                this.appListCollapsed = false;

                try {
                    const response = await axios.post('/app/getAppList', {
                        appName: this.appName.trim(),
                        areaCode: this.areaCode
                    }, {
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    });

                    if (response.data.code === 0) {
                        this.appList = response.data.data || [];

                        if (this.appList.length === 0) {
                            this.errorAppList = 'æœªæ‰¾åˆ°ç›¸å…³åº”ç”¨';
                        }
                    } else {
                        this.errorAppList = response.data.message || 'æœç´¢å¤±è´¥';
                    }
                } catch (err) {
                    console.error('æœç´¢åº”ç”¨åˆ—è¡¨é”™è¯¯:', err);
                    this.errorAppList = 'æœç´¢å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–æ¥å£åœ°å€';
                } finally {
                    this.loadingAppList = false;
                }
            },

            async selectApp(app) {
                // é€‰æ‹©åº”ç”¨æ—¶è‡ªåŠ¨å¡«å……appIdå¹¶æ¸…ç©ºç›¸å…³çŠ¶æ€
                this.appId = app.appId;
                this.results = [];
                this.error = '';
                this.searched = false;

                // æŠ˜å æœç´¢ç»“æœï¼Œä»¥ä¾¿æ›´å¥½åœ°å±•ç¤ºå•ä¸ªåº”ç”¨çš„æŸ¥è¯¢ç»“æœ
                this.appListCollapsed = true;

                // æç¤ºç”¨æˆ·æ­£åœ¨æŸ¥è¯¢è¯¦ç»†ä¿¡æ¯
                this.showToast(`å·²é€‰æ‹©åº”ç”¨ï¼š${app.appName}ï¼Œæ­£åœ¨æŸ¥è¯¢è¯¦ç»†ä¿¡æ¯...`);

                // ç›´æ¥æ‰§è¡ŒæŸ¥è¯¢
                await this.searchApp();
            },

            async searchApp() {
                if (!this.appId.trim()) {
                    this.error = 'è¯·è¾“å…¥App ID';
                    return;
                }

                // ç§»é™¤å¯èƒ½çš„"id"å‰ç¼€ï¼Œåªä¿ç•™æ•°å­—ID
                let cleanAppId = this.appId.trim();
                if (cleanAppId.toLowerCase().startsWith('id')) {
                    cleanAppId = cleanAppId.substring(2);
                }

                this.loading = true;
                this.error = '';
                this.results = [];

                try {
                    const response = await axios.post('/app/getAppInfo', {
                        appId: cleanAppId
                    }, {
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    });

                    if (response.data.code === 0) {
                        this.results = response.data.data || [];
                        this.searched = true;

                        if (this.results.length === 0) {
                            this.error = 'æœªæ‰¾åˆ°è¯¥åº”ç”¨çš„ä¿¡æ¯';
                        }
                    } else {
                        this.error = response.data.message || 'æŸ¥è¯¢å¤±è´¥';
                    }
                } catch (err) {
                    console.error('æŸ¥è¯¢é”™è¯¯:', err);
                    this.error = 'æŸ¥è¯¢å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–æ¥å£åœ°å€';
                } finally {
                    this.loading = false;
                }
            },

            showToast(message) {
                // åˆ›å»ºä¸´æ—¶æç¤ºæ¶ˆæ¯
                const toast = document.createElement('div');
                toast.className = 'toast toast-top toast-center z-50';
                toast.innerHTML = `
                                        <div class="alert" style="background: var(--fresh-gradient); color: white; border: none; box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);">
                                            <span>${message}</span>
                                        </div>
                                    `;
                document.body.appendChild(toast);

                // 3ç§’åç§»é™¤æç¤º
                setTimeout(() => {
                    toast.remove();
                }, 3000);
            },

            async getAreaList() {
                // è·å–åœ°åŒºåˆ—è¡¨
                this.areaListLoading = true;
                this.areaListError = '';

                try {
                    const response = await axios.post('/app/getAreaList', {}, {
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    });

                    if (response.data.code === 0) {
                        this.areaList = response.data.data || [];

                        // å¦‚æœæœ‰åœ°åŒºåˆ—è¡¨ä¸”å½“å‰areaCodeä¸åœ¨åˆ—è¡¨ä¸­ï¼Œåˆ™è®¾ç½®ä¸ºç¬¬ä¸€ä¸ªåœ°åŒº
                        if (this.areaList.length > 0 && !this.areaList.some(area => area.code === this.areaCode)) {
                            this.areaCode = this.areaList[0].code;
                        }
                    } else {
                        this.areaListError = response.data.message || 'è·å–åœ°åŒºåˆ—è¡¨å¤±è´¥';
                        // ä¸ä½¿ç”¨é»˜è®¤åœ°åŒºåˆ—è¡¨ï¼Œä¿æŒareaListä¸ºç©º
                        this.areaList = [];
                    }
                } catch (err) {
                    console.error('è·å–åœ°åŒºåˆ—è¡¨é”™è¯¯:', err);
                    this.areaListError = 'è·å–åœ°åŒºåˆ—è¡¨å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–æ¥å£åœ°å€';
                    // ä¸ä½¿ç”¨é»˜è®¤åœ°åŒºåˆ—è¡¨ï¼Œä¿æŒareaListä¸ºç©º
                    this.areaList = [];
                } finally {
                    this.areaListLoading = false;
                }
            },

            // è·å–çƒ­é—¨æœç´¢è¯
            async getPopularSearchWords() {
                this.popularWordsLoading = true;
                this.popularWordsError = '';

                try {
                    const response = await axios.post('/app/getPopularSearchWordList', {}, {
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    });

                    if (response.data.code === 0) {
                        this.popularWords = response.data.data || [];
                    } else {
                        this.popularWordsError = response.data.message || 'è·å–çƒ­é—¨æœç´¢è¯å¤±è´¥';
                        this.popularWords = [];
                    }
                } catch (err) {
                    console.error('è·å–çƒ­é—¨æœç´¢è¯é”™è¯¯:', err);
                    this.popularWordsError = 'è·å–çƒ­é—¨æœç´¢è¯å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–æ¥å£åœ°å€';
                    this.popularWords = [];
                } finally {
                    this.popularWordsLoading = false;
                }
            },

            // é€‰æ‹©çƒ­é—¨æœç´¢è¯
            selectPopularWord(word) {
                this.appName = word;
                this.showPopularWords = false; // é€‰æ‹©åéšè—çƒ­é—¨è¯
                // è‡ªåŠ¨æ‰§è¡Œæœç´¢
                this.searchAppList();
            },

            // æœç´¢æ¡†è·å¾—ç„¦ç‚¹ï¼ˆæ¯æ¬¡éƒ½è·å–æœ€æ–°çƒ­é—¨æœç´¢è¯ï¼‰
            onSearchInputFocus() {
                // æ¯æ¬¡èšç„¦éƒ½é‡æ–°è·å–æœ€æ–°çš„çƒ­é—¨æœç´¢è¯
                if (!this.popularWordsLoading) {
                    this.getPopularSearchWords();
                }
                this.showPopularWords = true;
            },

            // æœç´¢æ¡†å¤±å»ç„¦ç‚¹ï¼ˆå»¶è¿Ÿéšè—ï¼Œç¡®ä¿ç‚¹å‡»äº‹ä»¶èƒ½æ­£å¸¸è§¦å‘ï¼‰
            onSearchInputBlur() {
                setTimeout(() => {
                    this.showPopularWords = false;
                }, 200);
            },

            init() {
                // è·å–åœ°åŒºåˆ—è¡¨
                this.getAreaList();

                // é¢„åŠ è½½çƒ­é—¨æœç´¢è¯
                this.getPopularSearchWords();

                // é¡µé¢åŠ è½½å®Œæˆåè®¾ç½®æ ‡å¿—ï¼Œé¿å…é—ªçƒ
                this.$nextTick(() => {
                    setTimeout(() => {
                        this.pageLoaded = true;
                    }, 100);
                });
            }
        }
    }
</script>
</body>
</html>
